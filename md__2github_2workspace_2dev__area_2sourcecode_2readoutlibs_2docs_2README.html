<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: readoutlibs - Generic Readout software and utilities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">readoutlibs - Generic Readout software and utilities</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md128"></a>Generic implementation for DUNE Upstream DAQ Readout Software.</p>
<h1><a class="anchor" id="autotoc_md129"></a>
Building and setting up the workarea</h1>
<p>How to clone and build DUNE DAQ packages, including <code>readoutlibs</code>, is covered in <a href="https://dune-daq-sw.readthedocs.io/en/latest/packages/daq-buildtools/">the daq-buildtools instructions</a>. For some sample examples that demonstrate how to use <code>readoutlibs</code> check out the documentation of <code>readoutmodules</code>.</p>
<h1><a class="anchor" id="autotoc_md130"></a>
A Deeper Look Into Readout: Functional Elements</h1>
<h2><a class="anchor" id="autotoc_md131"></a>
Data-flow Diagram (DFD)</h2>
<p>The functional elements are seen on the following DFD. Color codes indicate the ownership (or responsibility) of the DAQ subsystems: <span style="color:blue">Dataflow (=blue)</span> and <span style="color:red">Upstream DAQ (=red)</span>. <img src="https://cernbox.cern.ch/index.php/s/YmXmHC7LpsCjGjT/download" alt="functional-elements" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md132"></a>
Domains</h2>
<p>Individual domains represent a substantially different path of the raw data, including some sort of data interpretation, transformation, formatting, or buffering. Functional elements marked with <em>italicized</em> text.</p>
<ol type="1">
<li><b>Trigger Primitive (TP) handling domain</b> (<b>Input</b>: raw data, <b>Output</b>: TPs): The readout is responsible for <em>generating trigger primitives</em> from raw data, and <em>format</em> these TPs to the agreed data-format. After this, the TPs can be <em>buffered</em> and <em>streamed</em> for other subsystems (most importantly, to Dataselection).</li>
<li><b>Raw Streaming domain</b> (<b>Input</b>: raw data, <b>Output</b>: raw/calib stream): The readout needs to interpret raw data and find possible problems and errors with and withing data (e.g.: timestamp continuity violation, data integrity, invalid headers, front-end specific error flags). Calibration flags in form of headers are also inside the front-end data frames. In case these flags are found, some data need to be <em>formatted</em> (e.g.: expanded based on channels ) then <em>streamed</em> to a configured destination (e.g.: local raw binary files or appfwk queues).</li>
<li><b>Requested Data domain</b> (<b>Input</b>: raw data and data requests -<a href="https://github.com/DUNE-DAQ/dfmessages/blob/develop/include/dfmessages/DataRequest.hpp">dfmessages::DataRequest</a>-, <b>Output</b>: special data requests to other functional elements and requested data -<a href="https://github.com/DUNE-DAQ/daqdataformats/blob/develop/include/daqdataformats/Fragment.hpp">daqdataformats::Fragment</a>-): This domains contains the conventional "triggered" readout mode. Data from the front-end are <em>processed and routed</em> to the appropriate destinations: either to the Raw Streaming domain (2) or to the raw data buffer (Latency Buffer). Incoming <em>requests are handled</em> via accessing the data buffer then match and extract the requested data for the request. Special requests (e.g.: recording) may be routed to different domains' functional elements, and data leaving the buffer may be intercepted if needed (e.g.: stream to store).</li>
<li><b>Recorded Data domain</b> (<b>Input</b>: raw data, "record" requests, <b>Output</b>: recorded data, metadata of data store, transfer acknowledgements and notifications): In case of a <code>record(O(seconds))</code> request, data leaving the latency buffer are streamed to a transient data store, which is usually local to the readout unit. The recorded data are transferred to other DAQ subsystems with the help of additional metadata, notifications, and acknowledgements.</li>
</ol>
<h2><a class="anchor" id="autotoc_md133"></a>
Definitions</h2>
<ol type="1">
<li>Latency Buffer: A container that temporarily stores the raw data, and has certain attributes that ensures search-ability based on a lookup criteria. A notable example for this, is the lookup based on the timestamp, where the timestamp can be converted to an exact position in the buffer if the "timestamp continuity" attribute is ensured in the buffer.</li>
</ol>
<h2><a class="anchor" id="autotoc_md134"></a>
Class diagram</h2>
<p>A zoomable visualization of <a href="https://github.com/DUNE-DAQ/readout/">the readout code</a> for its <code>dunedaq-v2.8.0</code> release:</p>
<p><img src="https://cernbox.cern.ch/index.php/s/Hvyb41Ndj2MfKlw/download" alt="class-diagram" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md135"></a>
Looking into the directories</h1>
<p>At the top level, the readout package uses the same directory structure as other DUNE DAQ packages as described in <a href="https://dune-daq-sw.readthedocs.io/en/latest/packages/daq-cmake/">the daq-cmake documentation</a>. However, due its large number of files, additional subdirectories have been added to organize them. This approach is covered <a class="el" href="md__2github_2workspace_2dev__area_2sourcecode_2readoutlibs_2docs_2Directory-structure.html">here</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
